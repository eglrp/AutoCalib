#标定文档
### 一、三大坐标系 ###

1.世界坐标系：目标物体位置的参考系。除了无穷远，世界坐标可以根据运算方便与否自由放置。

2.摄像机坐标系：摄像机站在自己角度上衡量的物体的坐标系。摄像机坐标系的原点在摄像机的光心上，z轴与摄像机光轴平行。它是与拍摄物体发生联系的桥头堡，世界坐标系下的物体需先经历刚体变化转到摄像机坐标系（**旋转和平移**），然后再和图像坐标系发生关系。

3.图像坐标系：以摄像机拍摄的二维照片为基准建立的坐标系。用于指定物体在照片中的位置。

<center>

![总的转换关系](http://img.blog.csdn.net/20160509220120773?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

</center>

----------


### 二、相机标定 ###
1.内外参数

1）相机的内参数是六个分别为：1/dx、1/dy、r、u0、v0、f。**opencv里的说内参数是4个其为fx、fy、u0、v0**。实际其fx=F*Sx，其中的F就是焦距上面的f,Sx是像素/没毫米即上面的dx，其是最后面图里的后两个矩阵进行先相乘，得出的，则把它看成整体，就相当于4个内参。其是把r等于零，实际上也是六个。

- dx和dy表示：x方向和y方向的一个像素分别占多少长度单位，即一个像素代表的实际物理值的大小，其是实现图像物理坐标系与像素坐标系转换的关键。
- u0，v0表示图像的中心像素坐标和图像原点像素坐标之间相差的横向和纵向像素数

2）相机的外参数是6个：三个轴的旋转参数分别为（ω、δ、 θ）,然后把每个轴的3×3旋转矩阵进行组合（即先矩阵之间相乘），得到集合三个轴旋转信息的R，其大小还是3×3；T的三个轴的平移参数（Tx、Ty、Tz）。R、T组合成成的3*4的矩阵，其是转换到标定纸坐标的关键。

**注意：在每个视场无论我们能提取多少个角点，我们只能得到四个有用的角点信息，这四个点可以产生8个方程，6个用于求外参，这样每个视场就还赚两个方程来求内参，则其在多一个视场即可求出4个内参。因为六个外参，这就是为什么要消耗三个点用于求外参。**

<center>
![](https://pic3.zhimg.com/d5cc4e933c38cbdfdae47e664d0b9ae6_b.png)
</center>

2.畸变系数

k1,k2,k3径向畸变系数，p1,p2是切向畸变系数。径向畸变发生在相机坐标系转图像物理坐标系的过程中。而切向畸变是发生在相机制作过程，其是由于感光元平面跟透镜不平行。

----------
### 三、激光·相机标定 ###

1.相机畸变校正

- 应用最小二乘法估算

2.遍历棋盘格内角点，找到激光线与棋盘格竖直线的交点

- cross ratio 

3.getAndSaveTransformation

----------
### 四、双目视觉标定 ###

> 结构参数。告诉你右摄像机是怎样相对于左摄像机经过旋转和平移达到现在的位置。
通过结构参数，便能把左右摄像机获取的图像的每一个像素点之间的关系用数学语言定量描述，保证两个相机都处于我们“可求”的状态。

1.两摄像头之间的相对位置

<center>

R = Rr(Rl)T

T = Tr - RTl

</center>

其中，R为两摄像头间的旋转矩阵，T为两摄像头间的平移矩阵。Rr为右摄像头经过张氏标定得到的相对标定物的旋转矩阵，Tr为右摄像头通过张氏标定得到的相对标定物的平移向量。Rl为左摄像头经过张氏标定得到的相对相同标定物的旋转矩阵，Tl为左摄像头经过张氏标定得到的相对相同标定物的平移向量。

2.立体校正

1）将两个平面拉回到同一平面

立体校正的时候需要两幅图像共面并且行对准 以使得立体匹配更加的可靠使得两幅图像共面的方法就是把两个摄像头的图像投影到一个公共成像面上，这样每幅图像从本图像平面投影到公共图像平面都需要一个旋转矩阵R

stereoRectify 这个函数计算的就是从图像平面投影都公共成像平面的旋转矩阵Rl,Rr。 Rl,Rr即为左右相机平面行对准的校正旋转矩阵。左相机经过Rl旋转，右相机经过Rr旋转之后，两幅图像就已经共面并且行对准了。

**其中Pl,Pr为两个相机的投影矩阵**，其作用是将3D点的坐标转换到图像的2D点的坐标:`P*[X Y Z 1]' =[x y w]`

**Q矩阵为重投影矩阵**，即矩阵Q可以把2维平面(图像平面)上的点投影到3维空间的点:`Q*[x y d 1] = [X Y Z W]。`其中d为左右两幅图像的时差


2）旋转图像使得同行对准

<center>

![左右图同行校准](http://img.blog.csdn.net/20141103102553436?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvb250aGV3YXlzdWNjZXNz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

</center>

----------
### 五、手眼标定 ###
> 在机器人校准测量、机器人手眼协调以及机器人辅助测量等领域，都要求知道机器人执行器末端（抓取臂）坐标系和传感器（比如用来测量三维空间中目标位置和方向并固定在机器人手上的摄像机）坐标系之间的相互关系，确定这种转换关系在机器人领域就是通常所说的手眼标定。

1.利用罗德里格斯变换将旋转矩阵转换为旋转向量

2.向量归一化

3.修正的罗德里格斯参数表示姿态变换

4.计算初始旋转向量

5.计算旋转向量

6.计算旋转矩阵

7.计算平移向量

----------
### 六、标定过程中的常见问题 ###
1.为什么要用多张标定板图片做标定？

根据线性代数，把解矩阵方程转化成解方程组的问题，由于**一张棋盘格只能提供8个相互独立的方程**(具体原因请查阅[透视变换原理](http://blog.csdn.net/goncely/article/details/5397729))，所以不足以求出10个未知数。理论上，只需2个棋盘格便足够解出全部参数了，但是matlab、opencv等为了增强鲁棒性，还内设了优化方法，使用更多的棋盘格也就是用更多的信息来求得最优解。

2.如何摆放标定板？

要这么多棋盘格图片其实是为了获得更多的图像坐标-世界坐标信息，进而做优化，得到标定参数的最优解。所以摆放的选择只有一个:**彼此位姿越不同越好。**位姿越不同的两张棋盘格图片，其利用角点坐标建立的方程就越独立，越有代表性。可以用极限法去理解上面的话:假如每张棋盘摆放都完全一样，那就算拍了一万张标定板图片，也只能提供8条相互独立的方程，依然解不了方程组。


----------

#### 参考文献： ####
1.[双目视觉几何框架详解](http://www.cnblogs.com/dverdon/p/5609124.html)

2.[内参、外参、畸变参数三种参数与相机的标定方法与相机坐标系的理解](http://blog.csdn.net/yangdashi888/article/details/51356385)

3.[Camera calibration With OpenCV](http://www.opencv.org.cn/opencvdoc/2.3.2/html/doc/tutorials/calib3d/camera_calibration/camera_calibration.html#cameracalibrationopencv)

4.《visual sensing and its application》

5.[根据旋转前后的向量值求旋转矩阵 ](http://www.cnblogs.com/xpvincent/archive/2013/02/15/2912836.html)

6.[A New Technique for Fully Autonomous and Efficient 3D Robotics Hand/Eye Calibration](http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=34770&newsearch=true&queryText=A%20New%20Technique%20for%20Fully%20Autonomous%20and%20Efficient%203D%20Robotics%20Hand/Eye%20Calibration)

7.[经典手眼标定算法之Tsai-Lenz的OpenCV实现](http://blog.csdn.net/yunlinwang/article/details/51871520)